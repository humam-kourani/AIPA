<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
      integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/bpmn-js/dist/assets/diagram-js.css"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/bpmn-js/dist/assets/bpmn-font/css/bpmn-embedded.css"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="../static/css/style.css"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
    />

    <title>LLM@PM</title>
    <script
      type="text/javascript"
      src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.16.0/d3.min.js"
      charset="utf-8"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/dagre-d3/0.6.1/dagre-d3.min.js"
    ></script>
    <!-- <script type="text/javascript" src="https://unpkg.com/bpmn-js@17.0.2/dist/bpmn-navigated-viewer.production.min.js"></script> -->
    <script
      src="https://unpkg.com/bpmn-js/dist/bpmn-modeler.development.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script
      type="text/javascript"
      src="../static/js/generalSettings.js"
    ></script>
    <script type="text/javascript" src="../static/js/bpmnLayouter.js"></script>
    <script type="text/javascript" src="../static/js/bpmnLoader.js"></script>
    <script type="text/javascript" src="../static/js/chat.js"></script>
    <script type="text/javascript" src="../static/js/errorHandling.js"></script>
    <script type="text/javascript" src="../static/js/sidebar.js"></script>

    <!-- Font Awesome JS -->
    <script
      defer
      src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js"
      integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ"
      crossorigin="anonymous"
    ></script>
    <script
      defer
      src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js"
      integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY"
      crossorigin="anonymous"
    ></script>
    <!-- jQuery Custom Scroller CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>
  </head>

  <body>
    <!-- Popper.JS -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
      integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
      crossorigin="anonymous"
    ></script>
    <!-- Bootstrap JS -->
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
      integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
      crossorigin="anonymous"
    ></script>

    <div class="wrapper">
      <!-- Sidebar -->
      <nav id="sidebar">
        <div class="sidebar-header">
          <button
            id="dismiss"
            type="button"
            class="close"
            aria-label="Close"
            style="margin-left: auto; cursor: pointer"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="container mt-5" style="padding: 30px">
          <h2 class="mb-4">OpenAI API Configuration</h2>
          <!-- The action attribute can be removed since you're handling data with JS -->
          <div class="form-group" style="display: none">
            <label for="api_url">API URL:</label>
            <input
              type="text"
              class="form-control"
              id="api_url"
              name="api_url"
              value="https://api.openai.com/v1/"
            />
          </div>
          <div class="form-group">
            <label for="model_name">Model Name:</label>
            <select name="model_name" id="model_name">
              <option value="gpt-3.5-turbo" selected>gpt-3.5-turbo</option>
              <option value="gpt-4-turbo-preview">gpt-4-turbo-preview</option>
              <option value="gpt-4">gpt-4</option>
            </select>
          </div>
          <div class="form-group">
            <label for="api_key">API Key:</label>
            <input
              type="password"
              class="form-control"
              id="api_key"
              name="api_key"
              placeholder="Enter OpenAI API key"
              required
            />
          </div>
          <button type="button" class="btn btn-primary" id="saveConfig">
            Save
          </button>
        </div>
      </nav>

      <!-- Page Content -->
      <div id="content">
        {% for message in get_flashed_messages(category_filter=["error"]) %}
        <div class="alert alert-danger">{{ message }}</div>
        {% endfor %}

        <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
          <button class="navbar-toggler" type="button" id="sidebarCollapse">
            <span class="navbar-toggler-icon"></span>
            <span style="color: #fff; font-weight: bold; margin-left: 5px"
              >configure</span
            >
            <!-- Add your text here -->
          </button>

          <div class="mx-auto" style="">
            <a class="navbar-brand" href="#">LLM@PM</a>
          </div>
        </nav>

        <div>
          <div class="container mt-5">
            <h2>Upload BPMN Model</h2>
            <form
              id="upload-form"
              action="{{ url_for('upload_bpmn') }}"
              method="POST"
              enctype="multipart/form-data"
            >
              <div class="form-group">
                <input
                  type="file"
                  class="form-control-file"
                  id="bpmnFile"
                  name="bpmnFile"
                  accept=".bpmn"
                />
              </div>
              <button type="submit" class="btn btn-primary">Upload</button>
            </form>
          </div>

          {% if bpmn_content_base64 %}
          <div style="visibility: hidden; position: absolute">
            <svg width="90%" height="90%">
              <g />
            </svg>
          </div>
          <div
            id="canvas"
            style="
              height: 90%;
              width: 90%;
              padding: 0;
              margin: 0;
              position: absolute;
            "
          ></div>

          <div style="visibility: hidden">
            <div style="position: fixed; top: 0px; left: 0px">
              <svg id="internalSvg" style="width: 0%; height: 0%"></svg>
            </div>
            <div
              id="internalCanvas"
              style="
                height: 0%;
                width: 0%;
                padding: 0;
                margin: 0;
                top: 0px;
                left: 0px;
                position: fixed;
              "
            ></div>
          </div>

          <div class="container mt-5" style="margin-bottom: 120px">
            <div class="chat-model-container">
              <div class="model-section">
                <h2>BPMN Model</h2>
                <div
                  id="bpmn-container"
                  data-bpmn-content="{{ bpmn_content_base64 }}"
                  style="height: 600px; border: 1px solid #000"
                ></div>
              </div>
              <div class="chat-section">
                <div class="container mt-5">
                  <h2>
                    Chat About the Uploaded BPMN
                    <span style="float: right">
                      <button
                        type="button"
                        class="btn btn-warning"
                        id="reset_button"
                        style="margin-left: 5px"
                      >
                        Reset Conversation
                      </button></span
                    >
                  </h2>
                  <!-- <p style="font-size: smaller; margin-top: -10px;">Only selected parts are considered. If nothing is selected, the chat pertains to the entire BPMN.</p> -->
                </div>

                <div class="container">
                  <div class="row clearfix">
                    <div class="col-lg-12">
                      <div class="card chat-app">
                        <div class="chat">
                          <div class="chat-history" id="chat-history-parent">
                            <ul class="m-b-0" id="chat-history"></ul>
                          </div>

                          <div
                            class="stage"
                            id="dotFalling"
                            style="margin-left: 40px"
                          >
                            <div class="dot-falling"></div>
                          </div>

                          <div class="chat-message clearfix">
                            <div class="input-group mb-0">
                              <input
                                id="chatInput"
                                type="text"
                                class="form-control"
                                placeholder="Type your message..."
                              />
                              <div class="input-group-append">
                                <span class="input-group-text">
                                  <i
                                    class="fa fa-paper-plane"
                                    style="cursor: pointer"
                                    onclick="sendMessage()"
                                    id="chatButton"
                                  ></i>
                                </span>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {% endif %}
          </div>
        </div>

        <!-- Dark Overlay element -->
        <div class="overlay"></div>
      </div>
    </div>

    <div
      class="modal fade"
      id="errorModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="errorModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="errorModalLabel">Error</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <!-- Error message will be inserted here -->
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
